<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Los Simpson</title>
  <link rel="stylesheet" href="../css/styles.css">
   <style>
    body {
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      color: #000;
      font-family: Arial, sans-serif;
      min-height: 100vh;
    }

    section {
        width: 412px !important;
        height: 777px !important;
      margin: 30px auto;
      background: url('images/simspn/fondo.png') center center/cover no-repeat;
      border-radius: 30px !important;
      overflow: hidden;
    }

     p {
        text-align: center;
        margin: auto;
    }
    .status-bar {
      display: flex;
      justify-content: space-between;
      margin: 0;
      background: rgba(163, 242, 36, 0.651);
      border-radius: 10px;
      padding: 8px 16px;
      font-size: 1.1rem;
      font-weight: bold;
      box-shadow: none;
    }

    .status-bar span {
      display: flex;
      align-items: center;
      gap: 7px;
    }

    .status-bar img {
      width: 22px;
      vertical-align: middle;
      opacity: 0.8;
    }

    .memory-board {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(4, 122px);
      gap: 16px;
      justify-content: center;
      margin: 0 auto;
      padding: 10px 0;
    }
    .memory-card {
      width: 100px;
      height: 122px;
      background: rgba(217, 217, 217,);
      opacity: 100%;
      border-radius: 15px;
      display: flex;
      margin: 0 auto;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      transition: transform 0.2s, box-shadow 0.2s;
      user-select: none;
      perspective: 600px;
    }

    .memory-card.flipped .card-inner,
    .memory-card.matched .card-inner {
      transform: rotateY(180deg);
    }

    .card-inner {
      width: 100%;
      height: 100%;
      position: relative;
      transition: transform 0.4s;
      transform-style: preserve-3d;
    }

    .memory-card .front,
    .memory-card .back {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      backface-visibility: hidden;
      border-radius: 18px;
    }

    .memory-card .front {
      background: rgba(35, 39, 47, 0.55);
      transform: rotateY(180deg);
      z-index: 2;
    }

    .memory-card .back {
      background: rgba(35, 39, 47, 0.55);
      z-index: 1;
    }

    .memory-card .front img,
    .memory-card .back img {
      width: 70px;
      height: 90px;
      object-fit: contain;
      filter: drop-shadow(0 2px 6px #D9D9D9);
    }

    .restart-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin: 0 auto;
      padding: 5px 20px;
      width: 50%;
      background: rgba(163, 242, 36, 0.651);
      color: #000;
      border: none;
      border-radius: 20px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 8px #0003;
      transition: background 0.2s, color 0.2s;
    }

    @media (max-width: 500px) {
      main {
        max-width: 98vw;
      }

      .memory-board {
        grid-template-columns: repeat(3, 1fr);
        justify-content: center;
        display: flex;
        margin: auto;
        gap: 8px;
        align-items: center;
      }

      .memory-card {
        width: 28vw;
        height: 28vw;
        min-width: 60px;
        min-height: 80px;
      }
    }
  </style>
</head>

<body class="jquery">
  <nav>
    <a href="index.html">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
        <path fill="#ffffff"
          d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
      </svg>
    </a>
  </nav>
  <main>
    <header>
        <h1>12-challenge-memory-game</h1>
        <p>Build a memory game using jQuery.</p>
    </header>
    <section>
        <div class="status-bar">
      <span><img src="images/simspn/â€”Pngtreeâ€”3d donut vector png_7261511 1.svg" alt="clock" /> <span id="timer">0</span> Second</span>
      <span><img src="images/simspn/correr.svg" alt="moves" /> <span id="moves">0</span> Moves</span>
    </div>
    <div class="fondo">
      <div class="memory-board"></div>
      <button class="restart-btn">Restart</button>
    </div>
    </section>
  </main>

  <script src="js/jquery-3.7.1.min.js"></script>
  <script>
    $(function () {
      let images = [
        'images/simspn/bart.svg', 'images/simspn/homero.svg', 'images/simspn/lisa.svg',
        'images/simspn/Ralph.svg', 'images/simspn/marge.svg', 'images/simspn/Krusty.svg'
      ]
      let backImg = 'images/simspn/buerger.svg'
      let cards = []
      let flipped = []
      let matched = 0
      let moves = 0
      let timer = 0
      let timerInterval = null
      let gameStarted = false
      let $board = $('.memory-board')
      let $moves = $('#moves')
      let $timer = $('#timer')

      $.shuffle = function (arr) {
        return arr.sort(() => 0.5 - Math.random())
      }
      $.delay = function (time) {
        return $.Deferred(d => setTimeout(d.resolve, time)).promise()
      }
      $.interval = function (callback, time) {
        let id = setInterval(callback, time)
        return { stop: () => clearInterval(id) }
      }
      $.windowOpen = function (url) {
        $('<a>', { href: url, target: '_blank' })[0].click()
      }
      function initGame() {
        cards = $.shuffle(images.concat(images))
        $board.empty()
        matched = 0
        moves = 0
        $moves.text('0')
        flipped = []
        gameStarted = false
        stopTimer()
        $timer.text('0')
        $.each(cards, function (i, card) {
          $board.append(
            `<div class="memory-card" data-index="${i}" data-img="${card}">
              <div class="card-inner">
                <div class="front"><img src="${card}" alt="img"></div>
                <div class="back"><img src="${backImg}" alt="?"></div>
              </div>
            </div>`
          );
        });
      }
      function cardClick($card) {
        if (flipped.length >= 2) return
        if (!gameStarted) {
          gameStarted = true
          startTimer()
        }
        $card.addClass('flipped')
        flipped.push($card)
        if (flipped.length === 2) {
          $.delay(400).then(checkMatch)
        }
      }
      function checkMatch() {
        moves++;
        $moves.text(moves);
        let img1 = flipped[0].data('img')
        let img2 = flipped[1].data('img')
        if (img1 === img2) {
          flipped[0].addClass('matched')
          flipped[1].addClass('matched')
          matched += 2
          flipped = []
          if (matched === cards.length) {
            stopTimer()
            $.delay(500).then(function () {
              $('<div>')
                .text(`ðŸŽ‰ Â¡Felicidades! Has ganado en${moves} movimientos y ${timer} segundos. ðŸŽ‰`)
                .appendTo('body')
                .css({
                  "background": "linear-gradient(135deg, #00C853,)",
                    "color": "#fff",
                    "padding": "25px 40px",
                    "font-size": "20px",
                    "font-weight": "bold",
                    "text-align": "center",
                    "position": "fixed",
                    "top": "30%",
                    "left": "50%",
                    "transform": "translate(-50%, -50%) scale(0.9)",
                    "z-index": "9999",
                    "border-radius": "15px",
                    "box-shadow": "0 8px 20px rgba(0,0,0,0.3)",
                    "max-width": "80%",
                    "animation": "popup 0.3s ease-out forwards"
                })
                .fadeIn()
                .delay(2000)
                .fadeOut(function () { $(this).remove(); })
            })
          }
        } else {
          resetFlipped()
        }
      }

      function resetFlipped() {
        $.delay(800).then(function () {
          $('.memory-card.flipped:not(.matched)').removeClass('flipped')
          flipped = []
        })
      }

      /** Timer **/
      function startTimer() {
        timer = 0
        $timer.text('0')
        if (timerInterval) timerInterval.stop()
        timerInterval = $.interval(function () {
          timer++
          $timer.text(timer)
        }, 1000)
      }
      function stopTimer() {
        if (timerInterval) timerInterval.stop()
      }

      $board.on('click', '.memory-card:not(.flipped):not(.matched)', function () {
        cardClick($(this))
      });
      $('.restart-btn').click(initGame)

      initGame()
    });
  </script>
</body>
</html>